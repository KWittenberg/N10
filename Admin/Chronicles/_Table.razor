<div class="quickgrid-wrapper table-responsive">
    <QuickGrid Class="p-sm table table-hover align-middle" Items="FilteredChronicles?.AsQueryable()" Pagination="PaginationState">

        <div class="p-2 d-flex justify-content-between align-items-center">
            <h4 class="p-0 m-0 ms-2">@Title</h4>
            <div class="d-inline-flex align-items-center">
                <i class="bi bi-search"></i>
                <input type="search" class="ms-2 form-control form-control-sm" autofocus @bind="SearchTerm" @bind:event="oninput" placeholder=" search .." />
            </div>
            <div class="me-2 d-inline-flex align-items-center" stile="width: 5rem;">
                <label class="me-2 small text-muted">Items:</label>
                <select class="form-select form-select-sm" @bind="PaginationState.ItemsPerPage">
                    <option value="10">10</option>
                    <option value="25">25</option>
                    <option value="50">50</option>
                    <option value="100">100</option>
                    <option value="200">200</option>
                </select>
            </div>
        </div>

        <PropertyColumn Property="x => x.Id" Title="Id" Align="Align.Center" Sortable="true" />
        @if (App!.IsExpanded)
        {
            <PropertyColumn Property="x => x.Day" Title="Day" Align="Align.Center" Sortable="true" />
            <PropertyColumn Property="x => x.Month" Title="Month" Align="Align.Center" Sortable="true" />
            <PropertyColumn Property="x => x.Year" Title="Year" Align="Align.Center" Sortable="true" />
        }
        <TemplateColumn Title="Datum" Align="Align.Center" SortBy="@dateSort">
            <span class="@(context.Date.HasValue ? "text-success" : "text-danger")">@(context.Date.HasValue? context.Date.Value.ToShortDateString() : "NEPOZNAT")</span>
        </TemplateColumn>
        <PropertyColumn Property="x => x.Title" Title="Title" Align="Align.Center" Sortable="true" />
        <TemplateColumn Title="Content" Align="Align.Left">
            <span title="@context.Content">@(App!.IsExpanded ? context.Content : $"{context.Content[..Math.Min(80, context.Content.Length)]}...")</span>
        </TemplateColumn>
        <TemplateColumn Title="EnhancedContent" Align="Align.Left">
            <span title="@context.EnhancedContent">@(App!.IsExpanded ? context.EnhancedContent : $"{context.EnhancedContent?[..Math.Min(80, context.EnhancedContent.Length)]}...")</span>
        </TemplateColumn>
        @* <TemplateColumn Title="Ok" Align="Align.Center" SortBy="@okSort">
            <span>@(context.Date.HasValue ? "✅" : "❌")</span>
        </TemplateColumn> *@
        <TemplateColumn Title="Approved" Align="Align.Center" SortBy="@isApprovedSort">
            <span><i class="fas @(context.IsApproved ? "fa-check-circle" : "fa-times-circle") fa-lg @(context.IsApproved ? "text-success" : "text-danger")"></i></span>
        </TemplateColumn>
        <TemplateColumn Title="Actions" Align="Align.Center">
            <ChildContent>
                <span class=""><i class="bi bi-pencil-square"></i></span>
                <span class="ms-2 text-danger"><i class="bi bi-trash"></i></span>
            </ChildContent>
        </TemplateColumn>
    </QuickGrid>
    <div class="quickgrid-pagination">
        <Paginator State="PaginationState" />
    </div>
</div>


@code {
    [CascadingParameter] AppState? App { get; set; }
    [Parameter, EditorRequired] public List<Chronicle>? Chronicles { get; set; }
    [Parameter] public string? Title { get; set; }

    string? SearchTerm;
    List<Chronicle>? FilteredChronicles
    {
        get
        {
            if (string.IsNullOrWhiteSpace(SearchTerm)) return Chronicles;
            var term = SearchTerm!.ToLowerInvariant();
            return Chronicles?
                .Where(x =>
                    (x.Title != null && x.Title.ToLowerInvariant().Contains(term)) ||
                    (x.Content != null && x.Content.ToLowerInvariant().Contains(term)) ||
                    (x.EnhancedContent != null && x.EnhancedContent.ToLowerInvariant().Contains(term))
                )
                .ToList();
        }
    }

    GridSort<Chronicle> dateSort = GridSort<Chronicle>.ByAscending(x => x.Date);
    // GridSort<Chronicle> okSort = GridSort<Chronicle>.ByAscending(x => x.Date.HasValue);
    GridSort<Chronicle> isApprovedSort = GridSort<Chronicle>.ByAscending(x => x.IsApproved);
    readonly PaginationState PaginationState = new PaginationState { ItemsPerPage = 25 };
}
